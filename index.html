<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Employee App | The Light Park</title>
  
  <!-- Unified Cloud Sync & Permissions -->
  <script src="https://thelightparkops.com/shared/cloud-sync.js"></script>
  <script src="https://thelightparkops.com/shared/auth.js"></script>
  <script src="https://thelightparkops.com/shared/permissions.js"></script>
  
  <style>
    :root {
      --bg: #0a0a0f;
      --surface: #12121a;
      --surface2: #1a1a25;
      --border: #2a2a3a;
      --text: #f0f0f5;
      --text-dim: #8888a0;
      --purple: #a855f7;
      --teal: #06d6a0;
      --pink: #ec4899;
      --red: #ef4444;
      --orange: #f97316;
      --green: #22c55e;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    
    /* Splash Screen */
    #splash {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100vh;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s;
    }
    #splash.hidden { opacity: 0; pointer-events: none; }
    #splash img { max-width: 70%; max-height: 30vh; margin-bottom: 20px; }
    .splash-text { color: var(--text-dim); font-size: 14px; }
    
    /* Header */
    .header {
      background: linear-gradient(135deg, var(--purple), var(--teal));
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    
    .avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
    }
    
    .user-info { flex: 1; }
    .user-name { font-weight: 700; font-size: 18px; }
    .user-role { font-size: 13px; opacity: 0.9; }
    
    .admin-toggle {
      background: rgba(255,255,255,0.2);
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      color: white;
      font-size: 12px;
      cursor: pointer;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
      overflow-x: auto;
    }
    
    .tab {
      flex: 1;
      min-width: 100px;
      padding: 14px;
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
      white-space: nowrap;
    }
    
    .tab:hover { color: var(--text); }
    .tab.active { color: var(--purple); border-bottom-color: var(--purple); }
    
    /* Content */
    .content { padding: 20px; }
    .hidden { display: none !important; }
    
    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Employee Cards */
    .employee-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    
    .emp-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--purple), var(--pink));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
    }
    
    .emp-info { flex: 1; }
    .emp-name { font-weight: 700; font-size: 16px; }
    .emp-role { font-size: 13px; color: var(--text-dim); }
    .emp-venue { font-size: 12px; color: var(--teal); }
    
    .emp-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }
    .status-active { background: rgba(34, 197, 94, 0.2); color: var(--green); }
    .status-inactive { background: rgba(239, 68, 68, 0.2); color: var(--red); }
    .status-seasonal { background: rgba(249, 115, 22, 0.2); color: var(--orange); }
    
    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    
    .stat-value { font-size: 28px; font-weight: 800; }
    .stat-label { font-size: 11px; color: var(--text-dim); margin-top: 4px; }
    
    /* Modal */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: var(--surface);
      border-radius: 16px;
      width: 90%;
      max-width: 400px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 24px;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
    }
    
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 12px; color: var(--text-dim); margin-bottom: 6px; }
    
    .form-input {
      width: 100%;
      padding: 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
    }
    
    .form-select {
      width: 100%;
      padding: 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary { background: var(--purple); color: white; }
    .btn-primary:hover { background: #9333ea; }
    .btn-secondary { background: var(--surface2); color: var(--text); }
    .btn-danger { background: var(--red); color: white; }
    
    .btn-row { display: flex; gap: 10px; margin-top: 20px; }
    
    /* Sync Indicator */
    #syncIndicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #888;
      z-index: 9999;
    }
    
    /* Search */
    .search-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .search-bar input {
      flex: 1;
      padding: 12px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
    }
    
    .add-btn {
      padding: 12px 20px;
      background: var(--green);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* Filter Pills */
    .filter-pills {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 12px;
      margin-bottom: 16px;
    }
    
    .pill {
      padding: 8px 14px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      white-space: nowrap;
    }
    
    .pill.active {
      background: var(--purple);
      border-color: var(--purple);
    }
  </style>
</head>
<body>
  <!-- Splash -->
  <div id="splash">
    <img src="logo.png" alt="The Light Park">
    <div class="splash-text">Employee Management</div>
  </div>
  
  <!-- Header -->
  <div class="header">
    <div class="avatar" id="adminAvatar">ğŸ‘¤</div>
    <div class="user-info">
      <div class="user-name">Employee Hub</div>
      <div class="user-role">Staff Management System</div>
    </div>
    <button class="admin-toggle" onclick="toggleAdminMode()">âš™ï¸ Admin</button>
  </div>
  
  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" onclick="showTab('roster')">ğŸ‘¥ Roster</button>
    <button class="tab" onclick="showTab('roles')">ğŸ­ Roles</button>
    <button class="tab" onclick="showTab('venues')">ğŸ“ Venues</button>
    <button class="tab" onclick="showTab('sync')">ğŸ”„ Sync</button>
  </div>
  
  <!-- Roster Tab -->
  <div class="content" id="tab-roster">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="totalCount">0</div>
        <div class="stat-label">Total Employees</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="activeCount" style="color: var(--green);">0</div>
        <div class="stat-label">Active</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="seasonalCount" style="color: var(--orange);">0</div>
        <div class="stat-label">Seasonal</div>
      </div>
    </div>
    
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search employees..." oninput="filterEmployees()">
      <button class="add-btn" onclick="showAddModal()">+ Add</button>
    </div>
    
    <div class="filter-pills" id="venueFilters"></div>
    
    <div id="employeeList"></div>
  </div>
  
  <!-- Roles Tab -->
  <div class="content hidden" id="tab-roles">
    <div class="section-title">ğŸ­ Role Breakdown</div>
    <div id="rolesList"></div>
  </div>
  
  <!-- Venues Tab -->
  <div class="content hidden" id="tab-venues">
    <div class="section-title">ğŸ“ Venue Staff</div>
    <div id="venuesList"></div>
  </div>
  
  <!-- Sync Tab -->
  <div class="content hidden" id="tab-sync">
    <div class="section-title">ğŸ”„ Cross-App Sync</div>
    
    <div class="stat-card" style="margin-bottom: 16px;">
      <div class="stat-value" id="syncStatus">â€”</div>
      <div class="stat-label">Last Sync</div>
    </div>
    
    <p style="color: var(--text-dim); margin-bottom: 16px; font-size: 14px;">
      Employee data from this app syncs automatically to all connected apps:
    </p>
    
    <div style="display: grid; gap: 10px;">
      <div class="employee-card">
        <div class="emp-avatar">ğŸ‹ï¸</div>
        <div class="emp-info">
          <div class="emp-name">Training Hub</div>
          <div class="emp-role">Reads employees for training progress</div>
        </div>
        <span class="emp-status status-active">Connected</span>
      </div>
      <div class="employee-card">
        <div class="emp-avatar">ğŸš—</div>
        <div class="emp-info">
          <div class="emp-name">Field Ops</div>
          <div class="emp-role">Reads employees for staff check-ins</div>
        </div>
        <span class="emp-status status-active">Connected</span>
      </div>
      <div class="employee-card">
        <div class="emp-avatar">ğŸª</div>
        <div class="emp-info">
          <div class="emp-name">Tent Manager</div>
          <div class="emp-role">Reads employees for shift assignments</div>
        </div>
        <span class="emp-status status-active">Connected</span>
      </div>
      <div class="employee-card">
        <div class="emp-avatar">ğŸ¯</div>
        <div class="emp-info">
          <div class="emp-name">Command Center</div>
          <div class="emp-role">Reads employees for dashboard</div>
        </div>
        <span class="emp-status status-active">Connected</span>
      </div>
    </div>
    
    <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="forceSyncNow()">
      ğŸ”„ Force Sync Now
    </button>
  </div>
  
  <!-- Add/Edit Modal -->
  <div class="modal hidden" id="employeeModal">
    <div class="modal-content">
      <div class="modal-title" id="modalTitle">Add Employee</div>
      
      <div class="form-group">
        <label class="form-label">Full Name *</label>
        <input type="text" class="form-input" id="empName" placeholder="John Smith">
      </div>
      
      <div class="form-group">
        <label class="form-label">Role *</label>
        <select class="form-select" id="empRole">
          <option value="">Select role...</option>
          <option value="Show Tech">Show Tech</option>
          <option value="Photo Tent">Photo Tent</option>
          <option value="Gift Shop">Gift Shop</option>
          <option value="Parking">Parking</option>
          <option value="Guest Services">Guest Services</option>
          <option value="Mascot">Mascot</option>
          <option value="Build Lead">Build Lead</option>
          <option value="Field Ops">Field Ops</option>
          <option value="Manager">Manager</option>
          <option value="Security">Security</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Venue *</label>
        <select class="form-select" id="empVenue">
          <option value="">Select venue...</option>
          <option value="Pearland">Pearland</option>
          <option value="Santa Fe">Santa Fe</option>
          <option value="League City">League City</option>
          <option value="Katy">Katy</option>
          <option value="Floater">Floater (Multi-Venue)</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Phone</label>
        <input type="tel" class="form-input" id="empPhone" placeholder="(555) 123-4567">
      </div>
      
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="empEmail" placeholder="john@example.com">
      </div>
      
      <div class="form-group">
        <label class="form-label">PIN (for clock-in)</label>
        <input type="text" class="form-input" id="empPin" placeholder="1234" maxlength="4">
      </div>
      
      <div class="form-group">
        <label class="form-label">Status</label>
        <select class="form-select" id="empStatus">
          <option value="active">Active</option>
          <option value="seasonal">Seasonal</option>
          <option value="inactive">Inactive</option>
        </select>
      </div>
      
      <div class="btn-row">
        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveEmployee()" style="flex: 1;">Save Employee</button>
      </div>
    </div>
  </div>
  
  <!-- Sync Indicator -->
  <div id="syncIndicator"></div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let employees = [];
    let editingId = null;
    let currentFilter = 'all';
    let dataSync = null;
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function init() {
      // Log access (Employee App is accessible to everyone)
      if (typeof TLPPermissions !== 'undefined') {
        TLPPermissions.logAction('view', 'Accessed Employee App');
      }
      
      // Initialize sync
      if (window.TLPStaffSync) {
        dataSync = window.TLPStaffSync;
      }
      
      // Load employees
      await loadEmployees();
      
      // Render
      renderEmployees();
      renderRoles();
      renderVenues();
      updateStats();
      renderVenueFilters();
      
      // Hide splash
      setTimeout(() => document.getElementById('splash').classList.add('hidden'), 1500);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DATA MANAGEMENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function loadEmployees() {
      // Try cloud first
      if (dataSync) {
        try {
          const cloudData = await dataSync.getStaff();
          if (cloudData && cloudData.length > 0) {
            employees = cloudData;
            console.log('[Employee App] Loaded', employees.length, 'employees from cloud');
            document.getElementById('syncIndicator').style.background = '#06d6a0';
            return;
          }
        } catch (e) {
          console.error('[Employee App] Cloud load failed:', e);
        }
      }
      
      // Fall back to local storage
      const local = localStorage.getItem('tlp_employees');
      if (local) {
        try {
          const parsed = JSON.parse(local);
          employees = parsed.data || parsed;
          console.log('[Employee App] Loaded', employees.length, 'employees from local');
        } catch (e) {
          employees = [];
        }
      }
      
      // If still empty, add demo data
      if (employees.length === 0) {
        employees = getDemoEmployees();
        await saveEmployees();
      }
    }
    
    async function saveEmployees() {
      // Save locally
      localStorage.setItem('tlp_employees', JSON.stringify({
        data: employees,
        updatedAt: new Date().toISOString()
      }));
      
      // Sync to cloud
      if (dataSync) {
        try {
          const result = await dataSync.saveStaff(employees);
          document.getElementById('syncIndicator').style.background = result.synced ? '#06d6a0' : '#f97316';
          document.getElementById('syncStatus').textContent = new Date().toLocaleTimeString();
          console.log('[Employee App] Synced to cloud:', result.synced ? 'âœ“' : 'âœ—');
        } catch (e) {
          document.getElementById('syncIndicator').style.background = '#ef4444';
          console.error('[Employee App] Sync failed:', e);
        }
      }
    }
    
    function getDemoEmployees() {
      return [
        { id: '1', name: 'Maria Garcia', role: 'Photo Tent', venue: 'Pearland', phone: '(281) 555-0101', email: 'maria@tlp.com', pin: '1234', status: 'active', hireDate: '2024-09-15' },
        { id: '2', name: 'James Wilson', role: 'Show Tech', venue: 'Pearland', phone: '(281) 555-0102', email: 'james@tlp.com', pin: '2345', status: 'active', hireDate: '2024-10-01' },
        { id: '3', name: 'Sarah Johnson', role: 'Gift Shop', venue: 'Santa Fe', phone: '(409) 555-0103', email: 'sarah@tlp.com', pin: '3456', status: 'active', hireDate: '2024-09-20' },
        { id: '4', name: 'Mike Chen', role: 'Build Lead', venue: 'Floater', phone: '(281) 555-0104', email: 'mike@tlp.com', pin: '4567', status: 'active', hireDate: '2024-08-01' },
        { id: '5', name: 'Emily Brown', role: 'Manager', venue: 'League City', phone: '(281) 555-0105', email: 'emily@tlp.com', pin: '5678', status: 'active', hireDate: '2024-07-15' },
        { id: '6', name: 'David Lee', role: 'Parking', venue: 'Pearland', phone: '(281) 555-0106', email: 'david@tlp.com', pin: '6789', status: 'seasonal', hireDate: '2024-11-01' },
        { id: '7', name: 'Lisa Thompson', role: 'Guest Services', venue: 'Santa Fe', phone: '(409) 555-0107', email: 'lisa@tlp.com', pin: '7890', status: 'active', hireDate: '2024-10-15' },
        { id: '8', name: 'Chris Martinez', role: 'Mascot', venue: 'Floater', phone: '(281) 555-0108', email: 'chris@tlp.com', pin: '8901', status: 'seasonal', hireDate: '2024-11-15' }
      ];
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function renderEmployees() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      
      let filtered = employees.filter(emp => {
        const matchesSearch = emp.name.toLowerCase().includes(searchTerm) || 
                              emp.role.toLowerCase().includes(searchTerm);
        const matchesFilter = currentFilter === 'all' || emp.venue === currentFilter;
        return matchesSearch && matchesFilter;
      });
      
      const list = document.getElementById('employeeList');
      
      if (filtered.length === 0) {
        list.innerHTML = '<div style="text-align: center; color: var(--text-dim); padding: 40px;">No employees found</div>';
        return;
      }
      
      list.innerHTML = filtered.map(emp => `
        <div class="employee-card" onclick="editEmployee('${emp.id}')">
          <div class="emp-avatar">${getInitials(emp.name)}</div>
          <div class="emp-info">
            <div class="emp-name">${emp.name}</div>
            <div class="emp-role">${emp.role}</div>
            <div class="emp-venue">ğŸ“ ${emp.venue}</div>
          </div>
          <span class="emp-status status-${emp.status}">${emp.status}</span>
        </div>
      `).join('');
    }
    
    function renderVenueFilters() {
      const venues = ['all', ...new Set(employees.map(e => e.venue))];
      
      document.getElementById('venueFilters').innerHTML = venues.map(v => `
        <div class="pill ${currentFilter === v ? 'active' : ''}" onclick="filterByVenue('${v}')">
          ${v === 'all' ? 'ğŸ‘¥ All' : 'ğŸ“ ' + v}
        </div>
      `).join('');
    }
    
    function renderRoles() {
      const roleGroups = {};
      employees.forEach(emp => {
        if (!roleGroups[emp.role]) roleGroups[emp.role] = [];
        roleGroups[emp.role].push(emp);
      });
      
      document.getElementById('rolesList').innerHTML = Object.entries(roleGroups)
        .sort((a, b) => b[1].length - a[1].length)
        .map(([role, emps]) => `
          <div class="stat-card" style="margin-bottom: 12px; text-align: left;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div class="stat-value" style="font-size: 18px;">${role}</div>
              <div style="font-size: 24px; font-weight: 700; color: var(--purple);">${emps.length}</div>
            </div>
            <div style="margin-top: 10px; font-size: 13px; color: var(--text-dim);">
              ${emps.map(e => e.name).join(', ')}
            </div>
          </div>
        `).join('');
    }
    
    function renderVenues() {
      const venueGroups = {};
      employees.forEach(emp => {
        if (!venueGroups[emp.venue]) venueGroups[emp.venue] = [];
        venueGroups[emp.venue].push(emp);
      });
      
      document.getElementById('venuesList').innerHTML = Object.entries(venueGroups)
        .sort((a, b) => b[1].length - a[1].length)
        .map(([venue, emps]) => `
          <div class="stat-card" style="margin-bottom: 12px; text-align: left;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div class="stat-value" style="font-size: 18px;">ğŸ“ ${venue}</div>
              <div style="font-size: 24px; font-weight: 700; color: var(--teal);">${emps.length}</div>
            </div>
            <div style="margin-top: 10px; font-size: 13px; color: var(--text-dim);">
              ${emps.map(e => e.name + ' (' + e.role + ')').join(', ')}
            </div>
          </div>
        `).join('');
    }
    
    function updateStats() {
      document.getElementById('totalCount').textContent = employees.length;
      document.getElementById('activeCount').textContent = employees.filter(e => e.status === 'active').length;
      document.getElementById('seasonalCount').textContent = employees.filter(e => e.status === 'seasonal').length;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ACTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function showTab(tabId) {
      document.querySelectorAll('.content').forEach(el => el.classList.add('hidden'));
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      document.getElementById('tab-' + tabId).classList.remove('hidden');
      event.target.classList.add('active');
    }
    
    function filterByVenue(venue) {
      currentFilter = venue;
      renderVenueFilters();
      renderEmployees();
    }
    
    function filterEmployees() {
      renderEmployees();
    }
    
    function showAddModal() {
      editingId = null;
      document.getElementById('modalTitle').textContent = 'Add Employee';
      document.getElementById('empName').value = '';
      document.getElementById('empRole').value = '';
      document.getElementById('empVenue').value = '';
      document.getElementById('empPhone').value = '';
      document.getElementById('empEmail').value = '';
      document.getElementById('empPin').value = '';
      document.getElementById('empStatus').value = 'active';
      document.getElementById('employeeModal').classList.remove('hidden');
    }
    
    function editEmployee(id) {
      const emp = employees.find(e => e.id === id);
      if (!emp) return;
      
      editingId = id;
      document.getElementById('modalTitle').textContent = 'Edit Employee';
      document.getElementById('empName').value = emp.name;
      document.getElementById('empRole').value = emp.role;
      document.getElementById('empVenue').value = emp.venue;
      document.getElementById('empPhone').value = emp.phone || '';
      document.getElementById('empEmail').value = emp.email || '';
      document.getElementById('empPin').value = emp.pin || '';
      document.getElementById('empStatus').value = emp.status;
      document.getElementById('employeeModal').classList.remove('hidden');
    }
    
    function closeModal() {
      document.getElementById('employeeModal').classList.add('hidden');
    }
    
    async function saveEmployee() {
      const name = document.getElementById('empName').value.trim();
      const role = document.getElementById('empRole').value;
      const venue = document.getElementById('empVenue').value;
      
      if (!name || !role || !venue) {
        alert('Please fill in name, role, and venue');
        return;
      }
      
      const empData = {
        name,
        role,
        venue,
        phone: document.getElementById('empPhone').value.trim(),
        email: document.getElementById('empEmail').value.trim(),
        pin: document.getElementById('empPin').value.trim(),
        status: document.getElementById('empStatus').value
      };
      
      if (editingId) {
        // Update existing
        const idx = employees.findIndex(e => e.id === editingId);
        if (idx >= 0) {
          employees[idx] = { ...employees[idx], ...empData };
        }
      } else {
        // Add new
        employees.push({
          id: Date.now().toString(36),
          ...empData,
          hireDate: new Date().toISOString().split('T')[0]
        });
      }
      
      await saveEmployees();
      closeModal();
      renderEmployees();
      renderRoles();
      renderVenues();
      updateStats();
      renderVenueFilters();
    }
    
    async function forceSyncNow() {
      document.getElementById('syncStatus').textContent = 'Syncing...';
      await saveEmployees();
      alert('âœ“ Synced ' + employees.length + ' employees to cloud');
    }
    
    function toggleAdminMode() {
      // Future: toggle between admin and employee views
      alert('Admin mode - all features enabled');
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // HELPERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function getInitials(name) {
      return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // START
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    init();
  </script>
</body>
</html>
